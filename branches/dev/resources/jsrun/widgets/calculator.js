if(!PHP2Go.included[PHP2Go.baseUrl+'widgets/calculator.js']){Calculator=function(){this.container=null;this.input=null;this.trigger=null;this.target=null;this.elements=[['input','input','calcInput','0',3,false],['button','clear','calcRedButton','C',0,false],['button','clear_entry','calcRedButton','CE',0,true],['button','number7','calcBlueButton','7',0,false],['button','number8','calcBlueButton','8',0,false],['button','number9','calcBlueButton','9',0,false],['button','negate','calcRedButton','+/-',0,false],['button','percent','calcBlueButton','%',0,true],['button','number4','calcBlueButton','4',0,false],['button','number5','calcBlueButton','5',0,false],['button','number6','calcBlueButton','6',0,false],['button','plus','calcRedButton','+',0,false],['button','minus','calcRedButton','-',0,true],['button','number1','calcBlueButton','1',0,false],['button','number2','calcBlueButton','2',0,false],['button','number3','calcBlueButton','3',0,false],['button','multiply','calcRedButton','*',0,false],['button','divide','calcRedButton','/',0,true],['button','number0','calcBlueButton','0',0,false],['button','decimal','calcBlueButton','.',0,false],['button','result','calcResultButton','Resultado',2,false],['button','equals','calcRedButton','=',0,false]];this.ignore=false;this.left=0;this.right=0;this.newNum=true;this.pendingOp="";this.lastOp="";};Calculator.loaded=false;Calculator.singleton=null;Calculator.setup=function(opts){var tgr=$(opts.trigger);var trg=$(opts.target);var align=opts.align||"right";if(tgr&&trg){if(!Calculator.loaded){Calculator.loaded=true;Event.addLoadListener(function(){Calculator.singleton=c=new Calculator();c.build();});}Event.addListener(tgr,'click',function(){var c=Calculator.singleton;if(c.trigger==tgr){c.hide();}else{if(!trg.disabled&&!trg.readOnly)c.showAt(tgr,trg,align);}});}};Calculator.prototype.build=function(){var self=this;this.container=$N('div',null,{position:'absolute',display:'none'});this.container.setParentNode(document.body);var table=$N('table',this.container);table.className='calcTable';var tbody=$N('tbody',table);var cell,input,row=$N('tr',tbody);this.elements.walk(function(item,idx){cell=$N('td',row);(item[4]>0)&&(cell.colSpan=item[4]);input=$N(item[0],cell);input.id='calculator_'+item[1];input.name=item[1];input.className=item[2];if(item[0]=='input'){self.input=input;input.readOnly=true;input.value=item[3];}else{input.innerHTML=item[3];}(item[5])&&(row=$N('tr',tbody));});Event.addListener(table,'mouseover',function(e){e=(e||window.event);Element.addClass(e.target||e.srcElement,'calcButtonHilite');});Event.addListener(table,'mouseout',function(e){e=(e||window.event);Element.removeClass(e.target||e.srcElement,'calcButtonHilite');});$C(table.getElementsByTagName('button')).walk(function(item,idx){Event.addListener(item,'click',function(){self.buttonHandler(item);});});};Calculator.prototype.keyDownHandler=function(e){e=$EV(e);var o=PHP2Go.browser.opera;var c=Calculator.singleton,k=e.key();if(k==8||((k==46||k==110)&&!o)||(k==78&&o)){this.ignore=true;c.backspace();e.stop();}else{this.ignore=false;}};Calculator.prototype.keyPressHandler=function(e){e=$EV(e);if(!this.ignore){var c=Calculator.singleton;var k=e.key();if(k>=48&&k<=57){c.number(k-48);e.preventDefault();}else{var ctrlAlt=(e.ctrlKey||e.altKey);var ops={'43':'plus','45':'minus','42':'multiply','47':'divide','37':'percent','13':'equals','61':'equals'};switch(k){case 43:case 45:case 42:case 47:case 37:case 13:case 61:c.operation(ops[k]);e.preventDefault();break;case 67:case 99:if(!ctrlAlt){c.clear();e.preventDefault();}break;case 46:c.decimal();e.preventDefault();break;case 82:case 114:if(!ctrlAlt){c.result();e.preventDefault();}break;case 27:c.hide();e.preventDefault();break;}}}e.stop();};Calculator.prototype.buttonHandler=function(sender){switch(sender.name){case'number0':case'number1':case'number2':case'number3':case'number4':case'number5':case'number6':case'number7':case'number8':case'number9':this.number(sender.name.substring(6));break;case'plus':case'minus':case'multiply':case'divide':case'percent':case'equals':this.operation(sender.name);break;case'clear':this.clear();break;case'clear_entry':this.clearEntry();break;case'negate':this.negate();break;case'decimal':this.decimal();break;case'result':this.result();break;}};Calculator.prototype.mouseDownHandler=function(e){var c=Calculator.singleton;var t=$EV(e).target;if(!t.isChildOf(c.trigger)&&!t.isChildOf(c.container))c.hide();};Calculator.prototype.number=function(n){var i=this.input;if(this.newNum){i.value=n;this.newNum=false;}else{(i.value=="0"?i.value=n:i.value+=n);}};Calculator.prototype.operation=function(op){var tmp,i=this.input;if(op!='equals'&&this.pendingOp)this.pendingOp="";this.newNum=true;switch(this.pendingOp){case'plus':if(op!='equals'||this.lastOp!='equals')this.right=parseFloat(i.value,10);this.left+=this.right;break;case'minus':if(op!='equals'||this.lastOp!='equals')this.right=parseFloat(i.value,10);this.left-=this.right;break;case'multiply':if(op!='equals'||this.lastOp!='equals')this.right=parseFloat(i.value,10);this.left*=this.right;break;case'divide':if(op!='equals'||this.lastOp!='equals')this.right=parseFloat(i.value,10);this.left/=this.right;break;case'percent':if(op!='equals'||this.lastOp!='equals')this.right=parseFloat(i.value,10);this.left=(this.right/100)*this.left;break;default:this.left=parseFloat(i.value,10);break;}if(isNaN(this.left))this.left=0;i.value=this.left;this.lastOp=op;(op!='equals')&&(this.pendingOp=op);};Calculator.prototype.clear=function(){this.acc=0;this.lastOp="";this.pendingOp="";this.clearEntry();};Calculator.prototype.clearEntry=function(){this.input.value="0";this.newNum=true;};Calculator.prototype.negate=function(){this.input.value=parseFloat(this.input.value,10)*-1;};Calculator.prototype.decimal=function(){var i=this.input;if(this.newNum){i.value="0.";this.newNum=false;}else{if(i.value.indexOf('.')==-1)i.value+='.';}};Calculator.prototype.backspace=function(){var i=this.input;i.value=(i.value.length==1?"0":i.value.substring(0,i.value.length-1));};Calculator.prototype.result=function(){var t=this.target;var v=this.input.value;if(isFinite(parseFloat(v))){v=v.substring(0,t.maxLength);if(t.inputMask){var p=0,m=t.inputMask.mask;if(v!=""){if(m==CurrencyMask){v=Math.truncate(parseFloat(v),2).toString().replace(".",",");if(v.indexOf(',')==-1)v+=",00";if(v.indexOf(',')==(v.length-2))v+="0";v=v.replace(/[^\-0-9,]+/,"");}else if(m==IntegerMask){v=Math.round(parseFloat(v)).toString();}else if(m.intSize){p=v.indexOf('.');(p==-1)&&(p=v.length);if(p>m.intSize){alert(Lang.validator.invalidFloat.assignAll('',m.intSize,m.decSize));this.input.focus();return;}}}t.value=v;t.inputMask.update();}else{t.value=v;}}t.focus();this.hide();};Calculator.prototype.showAt=function(tgr,trg,align){var c=this.container;var pos=tgr.getPosition();var dim=tgr.getDimensions();tgr.blur();this.trigger=tgr;this.target=trg;if(align=="bottom")c.moveTo(pos.x+dim.width-c.getDimensions().width,pos.y+dim.height+2);else c.moveTo(pos.x+dim.width+2,pos.y);c.show();var tmp=trg.value;var input=$('calculator_input');if(trg.inputMask){if(trg.inputMask.mask==CurrencyMask)tmp=tmp.replace(".","").replace(",",".");else tmp=tmp.replace(/[^0-9\.]/,"");}input.value=tmp;this.left=0;this.right=0;this.newNum=(input.value!=""?false:true);this.pendingOp="";this.lastOp="";Event.addListener(document,'keydown',PHP2Go.method(this,'keyDownHandler'),true);Event.addListener(document,'keypress',PHP2Go.method(this,'keyPressHandler'),true);Event.addListener(document,'mousedown',PHP2Go.method(this,'mouseDownHandler'),true);};Calculator.prototype.hide=function(){this.trigger=null;this.container.hide();Event.removeListener(document,'keydown',PHP2Go.method(this,'keyDownHandler'),true);Event.removeListener(document,'keypress',PHP2Go.method(this,'keyPressHandler'),true);Event.removeListener(document,'mousedown',PHP2Go.method(this,'mouseDownHandler'),true);};PHP2Go.included[PHP2Go.baseUrl+'widgets/calculator.js']=true;}