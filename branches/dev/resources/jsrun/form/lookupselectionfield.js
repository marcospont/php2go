if(!PHP2Go.included[PHP2Go.baseUrl+'form/lookupselectionfield.js']){PHP2Go.include(PHP2Go.baseUrl+'util/stringlist.js');LookupSelectionField=function(id,available,selected,added,removed,sep){this.ComponentField($(id),'LookupSelectionField');this.top=$(this.id+'_top');this.available=$(available);this.selected=$(selected);this.added=$(added);this.removed=$(removed);this.count=$(this.id+'_cnt');this.buttons=$(this.id+'_add',this.id+'_addall',this.id+'_rem',this.id+'_remall');this.listSep=sep;this.changed=false;this.setup();this.updateButtons();};LookupSelectionField.extend(ComponentField,'ComponentField');LookupSelectionField.prototype.setup=function(){var self=this;this.fld.component=this;this.available.auxiliary=true;this.selected.auxiliary=true;this.added.auxiliary=true;this.added.value='';this.removed.auxiliary=true;this.removed.value='';this.count.innerHTML=this.selected.options.length-1;this.addedList=new StringList('',this.listSep);this.addedList.onUpdate=function(str){self.added.value=str;};this.removedList=new StringList('',this.listSep);this.removedList.onUpdate=function(str){self.removed.value=str;};this.preList=new StringList('',this.listSep);this.preList.importOptions(this.selected,1);this.originalList=[];var o=this.selected.options;for(i=1;i<o.length;i++)this.originalList.push([o[i].value,o[i].text]);Event.addListener(this.available.form,'reset',function(evt){self.clear();});};LookupSelectionField.prototype.isEmpty=function(){return(this.selected.options.length<2);};LookupSelectionField.prototype.clear=function(){if(this.changed){var o=this.selected.options;this.originalList.walk(function(item,idx){o[idx+1]=new Option(item[1],item[0]);});o.length=this.originalList.length+1;this.count.innerHTML=o.length-1;}this.addedList.clear();this.removedList.clear();this.updateButtons();};LookupSelectionField.prototype.setDisabled=function(b){this.available.disabled=b;this.selected.disabled=b;this.buttons.walk(function(item,idx){item.disabled=b;});};LookupSelectionField.prototype.focus=function(){if(this.beforeFocus()&&!this.available.disabled){this.available.focus();return true;}return false;};LookupSelectionField.prototype.serialize=function(force){if(!force&&this.available.disabled&&this.selected.disabled)return null;var self=this,name=this.name,val=[];if(!this.addedList.empty())val.push(this.addedList.toArray().map(function(item){return name+'['+self.added.name+'][]='+item.urlEncode();}).join('&'));if(!this.removedList.empty())val.push(this.removedList.toArray().map(function(item){return name+'['+self.removed.name+'][]='+item.urlEncode();}).join('&'));return(val.empty()?null:val.join('&'));};LookupSelectionField.prototype.addSingle=function(opt){var o=this.selected.options;var a=(!this.preList.contains(opt.value)&&!this.addedList.contains(opt.value));var r=this.removedList.contains(opt.value);if(a||r){o[o.length]=new Option(opt.text,opt.value);(r?this.removedList.remove(opt.value):this.addedList.add(opt.value));this.count.innerHTML=o.length-1;this.changed=true;opt.selected=false;}};LookupSelectionField.prototype.add=function(){var self=this,s=this.available.options,t=this.selected.options,a,r;$C(s).walk(function(o,idx){if(o.selected){try{self.raiseEvent('add',[o]);}catch(e){alert(e.message);throw $break;}self.addSingle(o);}});this.updateButtons();};LookupSelectionField.prototype.addAll=function(){var self=this,s=this.available.options,t=this.selected.options,a,r;$C(s).walk(function(o,idx){try{self.raiseEvent('add',[o]);}catch(e){alert(e.message);throw $break;}self.addSingle(o);});this.updateButtons();};LookupSelectionField.prototype.remove=function(){var self=this;var selectedField=$F(this.selected);selectedField.removeSelectedOptions(function(o){try{self.raiseEvent('remove',[o]);}catch(e){alert(e.message);throw $break;}(!self.changed)&&(self.changed=true);if(self.addedList.contains(o.value))self.addedList.remove(o.value);else self.removedList.add(o.value);},1);this.count.innerHTML=this.selected.options.length-1;this.updateButtons();};LookupSelectionField.prototype.removeAll=function(){var self=this,cnt=0;this.addedList.observing=this.removedList.observing=false;$C(this.selected.options).walk(function(o,idx){try{if(idx>0){self.raiseEvent('remove',[o]);if(self.addedList.contains(o.value))self.addedList.remove(o.value);else self.removedList.add(o.value);cnt++;}}catch(e){alert(e.message);throw $break;}});this.addedList.observing=this.removedList.observing=true;if(cnt){this.selected.options.length=(this.selected.options.length-cnt);this.count.innerHTML=(this.selected.options.length-1);this.changed=true;this.added.value=this.addedList.toString();this.removed.value=this.removedList.toString();this.updateButtons();}};LookupSelectionField.prototype.updateButtons=function(){var o=this.selected.options;this.buttons[2].disabled=(o.length<2);this.buttons[3].disabled=(o.length<2);};PHP2Go.included[PHP2Go.baseUrl+'form/lookupselectionfield.js']=true;}