<?xml version="1.0" encoding="iso-8859-1"?>
<!-- PHP2Go Examples : form.people.xml, used at crud.example.php -->
<!DOCTYPE form SYSTEM "..\..\docs\dtd\php2go_forms.dtd">
<form method="POST" action="~REQUEST_URI~" backurl="~PHP_SELF~">
	<!-- variables -->
	<variable name="id_project" default="-1"/>
	<!-- layout & style settings -->
	<style input="input_style" label="label_style" button="button_style"/>
	<!-- error summary settings -->
	<errors
		style="error_style" listmode="FORM_ERROR_BULLET_LIST"
		headerstyle="error_header" clientmode="FORM_CLIENT_ERROR_DHTML"
		clientcontainer="error_container" tplplaceholder="error"
	/>
	<section id="project" name="Project Form">
		<!-- project data -->
		<editfield name="name" label="Name" size="60" length="40" required="T"/>
		<editfield name="start_date" label="Start Date" size="10" length="12" mask="DATE" required="T"/>
		<editfield name="end_date" label="End Date" size="10" length="12" mask="DATE" required="T">
			<rule type="GT" field="start_date"/>
		</editfield>
		<lookupfield name="id_manager" label="Manager" width="150" required="T">
			<datasource>
				<keyfield>p.id_people</keyfield>
				<displayfield>p.name</displayfield>
				<lookuptable>people p</lookuptable>
				<orderby>p.name</orderby>
			</datasource>
		</lookupfield>
		<lookupselectionfield name="members" label="Members" required="T" insfield="added_members" remfield="removed_members">
			<lookupfield name="available" label="All People" width="150" size="5">
				<datasource>
					<keyfield>id_people</keyfield>
					<displayfield>name</displayfield>
					<lookuptable>people</lookuptable>
					<orderby>name</orderby>
				</datasource>
			</lookupfield>
			<lookupfield name="selected" label="Selected" width="150" size="5">
				<datasource>
					<keyfield>pp.id_people</keyfield>
					<displayfield>p.name</displayfield>
					<lookuptable>
						projects_people pp inner join
						people p on pp.id_people = p.id_people
					</lookuptable>
					<clause>pp.id_project = ~id_project~</clause>
					<orderby>p.name</orderby>
				</datasource>
			</lookupfield>
		</lookupselectionfield>
		<condsection id="details" name="Details" evalfunction="evalCondSection">
			<!-- new task -->
			<editfield name="task_name" label="Name" size="10" length="20"/>
			<editfield name="task_description" label="Description" size="25" length="200"/>
			<lookupfield name="task_id_owner" label="Owner" nofirst="T">
				<datasource>
					<keyfield>pp.id_people</keyfield>
					<displayfield>p.name</displayfield>
					<lookuptable>
						projects_people pp inner join
						people p on pp.id_people = p.id_people
					</lookuptable>
					<clause>pp.id_project = ~id_project~</clause>
					<orderby>p.name</orderby>
				</datasource>
			</lookupfield>
			<combofield name="task_status" label="Status" nofirst="T">
				<option value="O" caption="O"/>
				<option value="A" caption="A"/>
				<option value="C" caption="C"/>
			</combofield>
			<combofield name="task_priority" label="Priority" nofirst="T" default="N">
				<option value="L" caption="L"/>
				<option value="N" caption="N"/>
				<option value="H" caption="H"/>
			</combofield>
			<editfield name="task_start_date" label="Start Date" size="8" length="10" mask="DATE"/>
			<editfield name="task_end_date" label="End Date" size="8" length="10" mask="DATE"/>
			<button name="add" value="Add" type="BUTTON">
				<listener type="AJAX" event="onclick">
					<param name="method">POST</param>
					<param name="params">{action:"add_task", id_project:~id_project~}</param>
					<param name="form">project</param>
					<param name="onSuccess"><![CDATA[
						alert(response.responseText);
						window.location.href = window.location;
					]]></param>
					<param name="onFailure"><![CDATA[
						alert(response.responseText);
						$('task_name').focus();
					]]></param>
				</listener>
			</button>
			<!-- edit tasks -->
			<datagrid
				name="tasks" label="Tasks" tablewidth="750" style="dataGrid"
				headers="#,Name,Description,Owner,Status,Priority,Start Date,End Date"
				emptygridmessage="This project has no tasks" showcheckboxes="T"
			>
				<datasource>
					<keyfield>id_task</keyfield>
					<displayfield>
						id_task, name, description, id_owner, status, priority,
						date_format(start_date, '%d/%m/%Y') start_date,
						date_format(end_date, '%d/%m/%Y') end_date
					</displayfield>
					<lookuptable>tasks</lookuptable>
					<clause>id_project = ~id_project~</clause>
					<orderby>name</orderby>
				</datasource>
				<fieldset>
					<editfield name="name" size="10" length="20" required="T"/>
					<editfield name="description" size="25" length="200" required="T"/>
					<lookupfield name="id_owner" nofirst="T" required="T">
						<datasource>
							<keyfield>pp.id_people</keyfield>
							<displayfield>p.name</displayfield>
							<lookuptable>
								projects_people pp inner join
								people p on pp.id_people = p.id_people
							</lookuptable>
							<clause>pp.id_project = ~id_project~</clause>
							<orderby>p.name</orderby>
						</datasource>
					</lookupfield>
					<combofield name="status">
						<option value="O" caption="O"/>
						<option value="A" caption="A"/>
						<option value="C" caption="C"/>
					</combofield>
					<combofield name="priority">
						<option value="L" caption="L"/>
						<option value="N" caption="N"/>
						<option value="H" caption="H"/>
					</combofield>
					<editfield name="start_date" label="Start Date" size="8" length="10" mask="DATE" required="T"/>
					<editfield name="end_date" label="End Date" size="8" length="10" mask="DATE" required="T"/>
				</fieldset>
			</datagrid>
		</condsection>
		<button name="send" value="Send" type="SUBMIT"/>
		<button name="back" value="Back" type="BACK"/>
		<button name="delete" value="Delete Tasks" type="BUTTON">
			<listener type="AJAX" event="onclick">
				<param name="params">{action:"delete_tasks"}</param>
				<param name="form">project</param>
				<param name="formValidate">false</param>
				<param name="onSuccess"><![CDATA[
					alert(response.responseText);
					window.location.href = window.location;
				]]></param>
				<param name="onFailure"><![CDATA[
					alert(response.responseText);
				]]></param>
			</listener>
		</button>
	</section>
</form>