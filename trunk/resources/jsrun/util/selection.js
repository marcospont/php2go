if(!PHP2Go.included[PHP2Go.baseUrl+'util/selection.js']){Selection=function(doc,win){this.doc=doc;this.win=win||window;this.cache=null;};Selection.prototype.getSelection=function(){return(this.win.getSelection?this.win.getSelection():(this.doc.getSelection?this.doc.getSelection():this.doc.selection));};Selection.prototype.getRange=function(){var sel=this.getSelection();if(sel.getRangeAt){return(sel?sel.getRangeAt(0):this.doc.createRange());}else{return sel.createRange();}};Selection.prototype.getType=function(){var sel=this.getSelection();if(sel.getRangeAt){if(sel.rangeCount==1){var range=sel.getRangeAt(0);if(!range.collapsed&&(range.startContainer.nodeType==3||range.endContainer.nodeType==3))return'Text';if(range.startContainer==range.endContainer&&(range.endOffset-range.startOffset)==1)return'Control';}}else{return sel.type;}return'None';};Selection.prototype.getBookmark=function(){var sel=this.getSelection();if(sel.getRangeAt){if(sel.rangeCount>0)return sel.getRangeAt(0).cloneRange();}else{var range=sel.createRange();return range.getBookmark();}return null;};Selection.prototype.getSelectedHTML=function(){var elm=document.createElement('body');var range=this.getRange();if(range.cloneContents){elm.appendChild(range.cloneContents());}else{elm.innerHTML=range.htmlText;}return elm.innerHTML;};Selection.prototype.getSelectedElement=function(){var sel=this.getSelection(),range=this.getRange();if(range.item||range.parentElement){return(range.item?range.item(0):range.parentElement());}else if(sel&&range){var elm=range.commonAncestorContainer;if(!range.collapsed){if(range.startContainer==range.endContainer&&(range.endOffset-range.startOffset)==1){if(range.startContainer.hasChildNodes())elm=range.startContainer.childNodes[range.startOffset];}}if(elm.nodeType==1)return elm;while((elm=elm.parentNode)!==null&&elm.nodeType!=1);return elm;}return null;};Selection.prototype.getParentByTagNames=function(tags){var re=new RegExp("^("+tags.replace(/,/g,'|')+")$",'i');var sel=this.getSelection();var elm=this.getSelectedElement();if(elm){do{if(re.test(elm.nodeName))return elm;}while((elm=elm.parentNode)!=null);}return null;};Selection.prototype.selectElement=function(elm,collapse,start){var range,sel,b=this.doc.body;if(elm){collapse=Object.ifUndef(collapse,false);start=Object.ifUndef(start,true);if(b.createTextRange){range=b.createTextRange();try{range.moveToElementText(elm);collapse&&(range.collapse(start));range.select();}catch(e){}}else{sel=this.getSelection();if(sel){range=this.doc.createRange();range.selectNode(elm);sel.removeAllRanges();sel.addRange(range);}}}};Selection.prototype.collapse=function(start){var sel=this.getSelection();if(sel.createRange){var range=sel.createRange();range.collapse(start!==false);range.select();}else{if(start!==false)sel.collapseToStart();else sel.collapseToEnd();}};Selection.prototype.clear=function(){var sel=this.getSelection();if(sel.rangeCount){for(var i=0;i<sel.rangeCount;i++)sel.getRangeAt(i).deleteContents();}else{(sel.type!='None')&&(sel.clear());}};Selection.prototype.save=function(){this.cache=this.getBookmark();};Selection.prototype.restore=function(){var sel,range,b=this.doc.body;if(this.cache!=null){if(b.createTextRange){range=b.createTextRange();range.moveToBookmark(this.cache);range.select();}else if(sel=this.getSelection()){sel.removeAllRanges();sel.addRange(this.cache);}}};PHP2Go.included[PHP2Go.baseUrl+'util/selection.js']=true;}