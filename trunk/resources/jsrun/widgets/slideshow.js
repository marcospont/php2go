if(!PHP2Go.included[PHP2Go.baseUrl+'widgets/slideshow.js']){function SlideShow(attrs,func){this.Widget(attrs,func);this.image1=null;this.image2=null;this.foreground='image1';this.background='image2';this.toggleBtn=null;this.cnt=null;this.desc=null;this.delayInput=null;this.index=0;this.total=0;this.timer=null;this.loading=false;this.waiting=false;this.stopped=(!this.attributes['play']);}SlideShow.extend(Widget,'Widget');SlideShow.prototype.setup=function(){this.image1=$(this.attributes['id']+'_foreground');this.image2=$(this.attributes['id']+'_background');this.toggleBtn=$(this.attributes['id']+'_toggle');this.cnt=$(this.attributes['id']+'_count');this.desc=$(this.attributes['id']+'_description');this.delayInput=$(this.attributes['id']+'_delay');this.total=this.attributes['images'].length;var first=this.attributes['images'][this.index];this.desc.update(first.description||first.url);this[this.foreground].setOpacity(0.9999);this[this.background].setOpacity(0.9999);if(this.total>1){Event.addListener(this[this.foreground],'load',this.onImageLoaded.bind(this),true);Event.addListener(this[this.background],'load',this.onImageLoaded.bind(this),true);Event.addListener(this.toggleBtn,'click',this.onToggle.bind(this));Event.addListener(this.delayInput,'blur',this.onSetDelay.bind(this));this[this.foreground].src=first.url;this.cnt.update((++this.index)+"/"+this.total);if(!this.stopped)this.loadNextImage();}else{this[this.foreground].src=img.url;this.toggleBtn.disabled=true;}};SlideShow.prototype.onToggle=function(evt){if(this.stopped){this.stopped=false;this.loadNextImage();this.toggleBtn.update(this.attributes['pauseCaption']);}else{this.stopped=true;this.toggleBtn.update(this.attributes['playCaption']);}};SlideShow.prototype.onSetDelay=function(evt){evt=evt||window.event;var input=evt.target||evt.srcElement;if(/^[0-9]+$/.test(input.value)){this.attributes['delay']=input.value*1000;}else{alert(Lang.invalidValue);input.value=(this.attributes['delay']/1000);}};SlideShow.prototype.loadNextImage=function(){this.loading=true;this.waiting=true;this[this.background].setOpacity(1);this.timer=setTimeout(this.onTimerEnd.bind(this),this.attributes['delay']);this[this.background].src=this.attributes['images'][this.index].url;if(this.index==(this.attributes['images'].length-1)){this.index=0;}else{this.index++;}};SlideShow.prototype.onImageLoaded=function(evt){if(this.loading){if(this.stopped)return;this.resizeImage(this[this.background]);this.loading=false;if(!this.waiting){this.switchImage();}}else{this.resizeImage(this[this.foreground]);}};SlideShow.prototype.onTimerEnd=function(){if(this.stopped)return;if(this.waiting){clearTimeout(this.timer);this.waiting=false;if(!this.loading){this.switchImage();}}};SlideShow.prototype.resizeImage=function(img){var w=img.naturalWidth||img.clientWidth;var h=img.naturalHeight||img.clientHeight;if(w!=this.attributes['width']){h=Math.floor((h*this.attributes['width'])/w);w=this.attributes['width'];img.resizeTo(w,h);}img.style.visibility='visible';};SlideShow.prototype.switchImage=function(){this[this.foreground].style.zIndex=parseInt(this[this.foreground].style.zIndex,10)-1;this[this.foreground].style.visibility='hidden';this[this.background].style.zIndex=parseInt(this[this.background].style.zIndex,10)+1;var curIdx=(this.index==0?this.total-1:this.index-1);var curImg=this.attributes['images'][curIdx];this.cnt.update((curIdx+1)+"/"+this.total);this.desc.update(curImg.description||curImg.url);var tmp=this.foreground;this.foreground=this.background;this.background=tmp;this.loadNextImage();};PHP2Go.included[PHP2Go.baseUrl+'widgets/slideshow.js']=true;}