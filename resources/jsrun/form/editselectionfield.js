if(!PHP2Go.included[PHP2Go.baseUrl+'form/editselectionfield.js']){PHP2Go.include(PHP2Go.baseUrl+'util/stringlist.js');EditSelectionField=function(id,edit,lookup,added,removed,sep){this.ComponentField($(id),'EditSelectionField');this.top=$(this.id+'_top');this.edit=$(edit);this.lookup=$(lookup);this.added=$(added);this.removed=$(removed);this.count=$(this.id+'_cnt');this.buttons=$(this.id+'_add',this.id+'_rem',this.id+'_remall');this.listSep=sep;this.changed=false;this.setup();this.updateButtons();};EditSelectionField.extend(ComponentField,'ComponentField');EditSelectionField.prototype.setup=function(){var self=this;this.fld.component=this;this.edit.auxiliary=true;this.lookup.auxiliary=true;this.added.auxiliary=true;this.added.value='';this.removed.auxiliary=true;this.removed.value='';this.count.innerHTML=this.lookup.options.length-1;this.addedList=new StringList('',this.listSep);this.addedList.onUpdate=function(str){self.added.value=str;};this.removedList=new StringList('',this.listSep);this.removedList.onUpdate=function(str){self.removed.value=str;};this.preList=new StringList('',this.listSep);this.preList.importOptions(this.lookup,1);this.originalList=[];var o=this.lookup.options;for(var i=1;i<o.length;i++)this.originalList.push([o[i].value,o[i].text]);Event.addListener(this.edit.form,'reset',function(evt){self.clear();});};EditSelectionField.prototype.isEmpty=function(){return(this.lookup.options.length<2);};EditSelectionField.prototype.clear=function(){this.edit.value='';if(this.changed){var o=this.lookup.options;this.originalList.walk(function(item,idx){o[idx+1]=new Option(item[1],item[0]);});o.length=this.originalList.length+1;this.count.innerHTML=o.length-1;}this.addedList.clear();this.removedList.clear();this.updateButtons();};EditSelectionField.prototype.setDisabled=function(b){this.edit.disabled=b;this.lookup.disabled=b;this.buttons.walk(function(item,idx){item.disabled=b;});};EditSelectionField.prototype.focus=function(){if(this.beforeFocus()&&!this.edit.disabled){this.edit.focus();return true;}return false;};EditSelectionField.prototype.serialize=function(force){if(!force&&this.edit.disabled&&this.lookup.disabled)return null;var self=this,name=this.name,val=[];if(!this.addedList.empty())val.push(this.addedList.toArray().map(function(item){return name+'['+self.added.name+'][]='+item.urlEncode();}).join('&'));if(!this.removedList.empty())val.push(this.removedList.toArray().map(function(item){return name+'['+self.removed.name+'][]='+item.urlEncode();}).join('&'));return(val.empty()?null:val.join('&'));};EditSelectionField.prototype.add=function(opts){if(this.edit.value.trim()!=''){var idx,pos,v=this.edit.value,o=this.lookup.options,a,r;(opts.upper)&&(v=v.toUpperCase());(opts.lower)&&(v=v.toLowerCase());(opts.trim)&&(v=v.trim());(opts.capitalize)&&(v=v.capitalize());a=(!this.preList.contains(v)&&!this.addedList.contains(v));r=this.removedList.contains(v);if(a||r){try{this.raiseEvent('add',[v]);o[o.length]=new Option(v,v);(r?this.removedList.remove(v):this.addedList.add(v));this.count.innerHTML=o.length-1;this.changed=true;this.updateButtons();}catch(e){alert(e.message);this.edit.select();}}else{alert(Lang.duplicatedValue);this.edit.select();}}else{this.edit.focus();}};EditSelectionField.prototype.remove=function(){var self=this;var lookupField=$F(this.lookup);lookupField.removeSelectedOptions(function(o){try{self.raiseEvent('remove',[o]);(!self.changed)&&(self.changed=true);if(self.addedList.contains(o.value))self.addedList.remove(o.value);else self.removedList.add(o.value);}catch(e){alert(e.message);throw $break;}},1);this.count.innerHTML=this.lookup.options.length-1;this.updateButtons();};EditSelectionField.prototype.removeAll=function(){var self=this,cnt=0;this.addedList.observing=this.removedList.observing=false;$C(this.lookup.options).walk(function(o,idx){try{if(idx>0){self.raiseEvent('remove',[o]);if(self.addedList.contains(o.value))self.addedList.remove(o.value);else self.removedList.add(o.value);cnt++;}}catch(e){alert(e.message);throw $break;}});this.addedList.observing=this.removedList.observing=true;if(cnt){this.lookup.options.length=(this.lookup.options.length-cnt);this.count.innerHTML=(this.lookup.options.length-1);this.changed=true;this.added.value=this.addedList.toString();this.removed.value=this.removedList.toString();this.updateButtons();}};EditSelectionField.prototype.updateButtons=function(){var o=this.lookup.options;this.buttons[1].disabled=(o.length<2);this.buttons[2].disabled=(o.length<2);};PHP2Go.included[PHP2Go.baseUrl+'form/editselectionfield.js']=true;}