if(!PHP2Go.included[PHP2Go.baseUrl+'form/lookupchoice.js']){LookupChoiceField=function(id){this.ComponentField($(id),'LookupChoiceField');this.filter=$(id+'_filter');this.stringOptions='';this.options=[];this.lastFilter=null;this.setup();};LookupChoiceField.extend(ComponentField,'ComponentField');LookupChoiceField.prototype.setup=function(){var self=this;this.fld.component=this;this.filter.auxiliary=true;this.filter.originalColor=this.filter.getComputedStyle('color');this.filter.originalValue=this.filter.value;this.filter.style.color='InactiveCaption';this.filter.style.width=this.fld.getStyle('width');Event.addListener(this.filter,'focus',function(){if(self.filter.value==self.filter.originalValue){self.filter.value='';self.filter.style.color=self.filter.originalColor;}});Event.addListener(this.filter,'keyup',function(){if(self.filter.value!=self.lastFilter){self.updateList();self.lastFilter=self.filter.value;}});Event.addListener(this.filter,'paste',function(){self.updateList();});Event.addListener(this.filter,'blur',function(){if(self.filter.value.trim()==''){self.filter.value=self.filter.originalValue;self.filter.style.color='InactiveCaption';}});this.initializeList();};LookupChoiceField.prototype.getValue=function(){var idx=this.fld.selectedIndex;if(idx>=0&&this.fld.options[idx].value!="")return this.fld.options[idx].value;return null;};LookupChoiceField.prototype.setValue=function(val){var self=this,opt=$C(this.fld.options);opt.walk(function(item,idx){if(item.value==val){self.fld.value=val;item.selected=true;throw $break;}});};LookupChoiceField.prototype.clear=function(){this.fld.value='';$C(this.fld.options).walk(function(el,idx){el.selected=false;});};LookupChoiceField.prototype.setDisabled=function(b){this.filter.disabled=b;this.fld.disabled=b;};LookupChoiceField.prototype.initializeList=function(){var self=this;if(this.stringOptions==''){self.options=[];$C(this.fld.options).walk(function(item,idx){self.options.push(item);if(self.stringOptions!='')self.stringOptions+='|';self.stringOptions+=item.value+'~'+item.text;});}else{self.options=[];this.stringOptions.split('|').walk(function(item,idx){var option=item.split('~');self.options.push(new Option(option[1],option[0]));});}};LookupChoiceField.prototype.rebuildList=function(){this.initializeList();for(var i=0;i<this.options.length;i++){this.fld.options[i]=this.options[i];this.fld.options[i].selected=false;}this.fld.options.length=this.options.length;};LookupChoiceField.prototype.updateList=function(){var filter=this.filter.value.replace(/^\s*/,'');if(filter==''){this.rebuildList();}else{var j=0,opt=this.fld.options;var pattern=new RegExp("^"+filter,"i");this.initializeList();this.options.walk(function(item,idx){if(item.value!=""&&pattern.test(item.text)){opt[j]=item;opt[j].selected=false;opt.length=++j;}});if(j==1){opt[0].selected=true;this.fld.selectedIndex=0;}}};PHP2Go.included[PHP2Go.baseUrl+'form/lookupchoice.js']=true;}